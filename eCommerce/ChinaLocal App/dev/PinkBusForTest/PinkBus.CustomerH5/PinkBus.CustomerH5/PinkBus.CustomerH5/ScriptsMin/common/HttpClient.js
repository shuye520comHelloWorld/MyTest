define(["jquery","jquery-iplugin"],function(a){function b(){function b(i,j,k,l,m){var n=k;k||(k={}),a.isWeiXin()&&(k.access_token=localStorage.getItem(localStorage.UnionID),console.log("AT="+k.access_token)),f(e,k),i=d.GET===j?i+"?"+g(k):i;var o;XMLHttpRequest?(o=new XMLHttpRequest,"withCredentials"in o&&(o.open(j,i,!0),o.onreadystatechange=function(d){o.readyState===4&&(o.status>=200&&o.status<400?l(JSON.parse(o.responseText)):o.status==401?a.isWeiXin()?(h+=1,h>3&&(h=0,window.location.href=VirtualDirectory+"/Shared/WeChatError"),c.GetAccessToken(function(a){localStorage.setItem(localStorage.UnionID,a.accessToken),b(i,j,n,l,m)},null)):m({readyState:o.readyState,statusText:o.statusText,status:o.status}):m({statusText:o.statusText,responseText:JSON.parse(o.responseText),status:o.status}))})):XDomainRequest&&(o=new XDomainRequest,o.open(j,i),o.onload=function(){l(JSON.parse(o.responseText))}),o.setRequestHeader("Accept","application/json"),j==d.POST&&o.setRequestHeader("Content-Type","application/json"),o.send(d.GET===j?null:JSON.stringify(k))}var c=this,d={GET:"GET",POST:"POST"},e={Device:"Mobile",DeviceOS:"Andorid_IOS",DeviceVersion:"8.x",_UserId:"",_SubsidiaryCode:"CN",_ClientKey:"ProjectName",_UserName:"User"};window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var f=function(a,b){var c=null;for(var d in a){c=!1;for(var e in b)if(d==e){c=!0;continue}c||(b[d]=a[d])}return b},g=function(a){var b="";if(a===null||a==="")return null;for(var c in a)b+=c+"="+a[c]+"&";return b=b.substring(0,b.length-1),b},h=0;c.GetAccessToken=function(a,c,e){b(window.location.origin+VirtualDirectory+"/Wechat/GetAccessToken",d.POST,a,c,e)},c.GetUnionId=function(a,c,e){b(window.location.origin+VirtualDirectory+"/WeChat/GetUnionId",d.GET,null,c,e)},c.TrackEvent=function(a,c,e){b(TrackEventAPIUrl+"track/event",d.GET,a,c,e)},c.CheckWechatRemind=function(a,c,e){b(window.location.origin+VirtualDirectory+"/Wechat/CheckWechatRemind",d.GET,a,c,e)},c.AcceptInvitation=function(a,c,e){b(EXAPIUrl+"customers/invitation/accept/put",d.POST,a,c,e)},c.QueryInvitationBrowser=function(a,c,e){b(EXAPIUrl+"customer/invitation/query/"+a.TicketKey,d.GET,a,c,e)},c.QueryInvitation=function(a,c,e){b(EXAPIUrl+"customer/invitation/query",d.GET,a,c,e)}}return b})