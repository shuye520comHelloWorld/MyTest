define(["jquery","httpClient","moment","jquery-qrcode","main","jquery-iplugin","WechatShare"],function(a,b,c,d){function e(){var d=this,e=new b;d.showLoading=function(){return new Loading},d.hideLoading=function(b){a.proxy(b.destory,b)()},d.init=function(b){a.isWeiXin()?e.QueryInvitation({TicketKey:ticketKey},function(a){d.login(a,b)},function(b){a.alert(b.responseText.ResponseStatus.Message)}):e.QueryInvitationBrowser({TicketKey:ticketKey},function(a){d.login(a,b)},function(b){a.alert(b.responseText.ResponseStatus.Message)})},d.createQRCode=function(a){qrico_image=new Image,qrico_image.src=VirtualDirectory+"/Content/Images/qrcodeico250.jpg",qrico_image.onload=function(){d.updateQrCode(QRCodeUrl+ticketKey)}},d.updateQrCode=function(b){var c={render:"canvas",ecLevel:"H",minVersion:5,fill:"#333333",background:"#ffffff",text:b,size:160,radius:0,quiet:0,mode:4,mSize:.3,mPosX:.5,mPosY:.5,image:qrico_image};a("#container").empty().qrcode(c)},d.login=function(b,f){c.locale("zh-cn"),b.TicketType.toLowerCase()=="vip"?(a("body").removeClass().addClass("cardtype1"),a("#card-type").text("贵宾邀请券"),document.title="贵宾邀请券"):(a("body").removeClass().addClass("cardtype2"),document.title="来宾邀请券",a("#card-type").text("来宾邀请券")),a("#card-eventTitle").text(b.EventBaseInfo.EventTitle),a("#card-location").text(b.EventBaseInfo.Location),a("#card-dateTime").text(c(b.EventBaseInfo.EventStartDate).format("YYYY/MM/DD")==c(b.EventBaseInfo.EventEndDate).format("YYYY/MM/DD")?c(b.EventBaseInfo.EventStartDate).format("YYYY.MM.DD HH:mm")+" - "+c(b.EventBaseInfo.EventEndDate).format("HH:mm"):c(b.EventBaseInfo.EventStartDate).format("YYYY.MM.DD HH:mm")+" - "+c(b.EventBaseInfo.EventEndDate).format("YYYY.MM.DD HH:mm")),a("#card-consultantName").text(b.LastName+b.FirstName),a("#card-consultantPhone").text(a.formatPhone(b.ConsultantPhone)),a("#card-tel").attr("href","tel:"+b.ConsultantPhone),a("#card-sms").attr("href","sms:"+b.ConsultantPhone),a("#ticketKey").val(b.TicketKey);if(b.TicketStatus=="Inviting"&&a.isWeiXin()&&b.WechatUserType=="Inviter"&&!b.IsInvitationEnd)console.log(a("section:not(#card-invalid)")),a("section:not(#card-invalid)").remove(),a("#invitedendtime").text(c(b.EventBaseInfo.InvitationEndDate).format("ll")),a("#card-invalid").show();else if(b.TicketStatus=="Invited"&&a.isWeiXin()&&b.WechatUserType=="Inviter")a("section:not(#card-successbyconsu)").remove(),a(".card-customerName").text(b.CustomerName),d.createQRCode(),a("#card-successbyconsu").show();else if(a.isWeiXin()&&b.TicketStatus=="Invited"&&b.WechatUserType=="Customer")a("section:not(#card-successbyuser)").remove(),a(".user-name").text("来宾："+b.CustomerName),d.createQRCode(),a("#card-successbyuser").show();else if(b.IsInvitationEnd||b.TicketStatus=="Expired"||!a.isWeiXin()&&b.TicketStatus=="Invited"||a.isWeiXin()&&b.TicketStatus=="Invited"&&b.WechatUserType=="Other")a("section:not(#card-expired)").remove(),a("#card-expired").show();else{a("section:not(.info-form)").remove();var g={multi:["topic","series","content"],course:[{text:"是",value:1},{text:"否",value:0}],product:[{text:"是",value:1},{text:"否",value:0}],identity:[{text:"老顾客",value:"Old"},{text:"新顾客",value:"New"},{text:"VIP",value:"VIP"}],age:[{text:"25岁以下",value:"Blow25"},{text:"25-35岁",value:"Between25And35"},{text:"35-45岁",value:"Between35And45"},{text:"45岁以上",value:"Above45"}],profession:[{text:"公司职员",value:"Clerk"},{text:"私营业主",value:"PrivateOwner"},{text:"家庭主妇",value:"Housewife"},{text:"自由职业",value:"Freelancers"}],topic:[{text:"美容护肤",value:"SkinCare"},{text:"彩妆技巧",value:"MakeUp"},{text:"服饰搭配",value:"DressUp"},{text:"家庭关系",value:"FamilyTies"}],series:[{text:"幻时/幻时佳",value:"TimeWise"},{text:"美白",value:"WhiteningSystemFoaming"},{text:"经典",value:"Cleanser"},{text:"舒颜",value:"CalmingInfluence"},{text:"其他系列",value:"Other"}],content:[{text:"美丽自信",value:"BeautyConfidence"},{text:"公司文化",value:"CompanyCulture"},{text:"事业机会",value:"BusinessOpportunity"},{text:"其他",value:"Other"}]};a(".info-select").infoSelect(g),a(".info-form").show(),a("#name").focus(function(){a("#error_name").text("")}),a("#tel").focus(function(){a("#error_phone").text("")}),a("#identity").on("click",function(){a("#error_identity").text("")}),a("#age").on("click",function(){a("#error_age").text("")}),a("#submitform").click(function(){var b=a(this);if(b.attr("class").indexOf("disable")<0){var c=!1;a("#name").val().length==0?(a("#error_name").text("请输入顾客姓名"),c=!0):a("#name").checkChinaAndText()||(a("#error_name").text("请输入正确的顾客姓名"),c=!0),a("#tel").val().length==0?(a("#error_phone").text("请输入顾客的手机号码"),c=!0):a("#tel").checkPhoneNumber()||(a("#error_phone").text("手机号码格式不正确"),c=!0),a("#hid-identity").val().length==0&&(a("#error_identity").text("请选择来宾身份"),c=!0),a("#hid-age").val().length==0&&(a("#error_age").text("请选择年龄"),c=!0);if(c)return;var d={TicketKey:a("#ticketKey").val(),CustomerName:a("#name").val(),CustomerPhone:a("#tel").val(),CustomerType:a("#hid-identity").val(),AgeRange:a("#hid-age").val(),Career:a("#hid-profession").val(),InterestingTopic:a("#hid-topic").val(),BeautyClass:a("#hid-course").val(),UsedProduct:a("#hid-product").val(),UsedSet:a("#hid-series").val(),InterestInCompany:a("#hid-content").val(),UnionID:unionid,HeadImgUrl:headImgUrl,Source:a.isWeiXin()?"Wechat":"MobileBrowser"};e.AcceptInvitation(d,function(b){b.Result?window.location.href=VirtualDirectory+"/home/success?TicketKey="+b.TicketKey:a.alert(b.ErrorMessage)},function(b){a.alert(b.responseText.ResponseStatus.Message)})}})}d.hideLoading(f)}}return e})