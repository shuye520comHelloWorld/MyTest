define(["jquery","httpClient","moment","jquery-qrcode","jquery-iplugin","main"],function(a,b,c,d){function e(){var d=new b,e=this;e.init=function(b){a.isWeiXin()?(d.QueryInvitation({TicketKey:ticketKey},function(a){e.login(a,b)}),d.CheckWechatRemind({},function(b){b.isCheck||(a(".success-modal").show(),a(".success-modal-bg").show())})):d.QueryInvitationBrowser({TicketKey:ticketKey},function(a){e.login(a,b)}),a("#smClose").on("click",function(b){a(".success-modal").hide(),a(".success-modal-bg").hide()})},e.login=function(b,d){b.TicketType.toLowerCase()=="vip"?(a("body").removeClass().addClass("cardtype1"),a(".card-customerType").text("贵宾："),a("#card-type").text("贵宾邀请券"),document.title="贵宾邀请券"):(a("body").removeClass().addClass("cardtype2"),a(".card-customerType").text("来宾："),document.title="来宾邀请券",a("#card-type").text("来宾邀请券")),a("#card-eventTitle").text(b.EventBaseInfo.EventTitle),a("#card-location").text(b.EventBaseInfo.Location),a("#card-dateTime").text(c(b.EventBaseInfo.EventStartDate).format("YYYY/MM/DD")==c(b.EventBaseInfo.EventEndDate).format("YYYY/MM/DD")?c(b.EventBaseInfo.EventStartDate).format("YYYY.MM.DD HH:mm")+" - "+c(b.EventBaseInfo.EventEndDate).format("HH:mm"):c(b.EventBaseInfo.EventStartDate).format("YYYY.MM.DD HH:mm")+" - "+c(b.EventBaseInfo.EventEndDate).format("YYYY.MM.DD HH:mm")),a("#card-consultantName").text(b.LastName+b.FirstName),a("#card-consultantPhone").text(a.formatPhone(b.ConsultantPhone)),a("#card-tel").attr("href","tel:"+b.ConsultantPhone),a("#card-sms").attr("href","sms:"+b.ConsultantPhone),a.isWeiXin()?(a("#card-customer").text(b.CustomerName),a("section:not(#card-success-wechat)").remove(),a("#card-success-wechat").show()):(a("#card-customer-2").text(b.CustomerName),a("section:not(#card-success-brower)").remove(),a("#card-success-brower").show()),qrico_image=new Image,qrico_image.src=VirtualDirectory+"/Content/Images/qrcodeico250.jpg",qrico_image.onload=function(){e.updateQrCode(QRCodeUrl+ticketKey)},e.hideLoading(d)},e.updateQrCode=function(b){var c={render:"canvas",ecLevel:"H",minVersion:5,fill:"#333333",background:"#ffffff",text:b,size:160,radius:0,quiet:0,mode:4,mSize:.3,mPosX:.5,mPosY:.5,image:qrico_image};a("#container").empty().qrcode(c)},e.showLoading=function(){return new Loading},e.hideLoading=function(b){a.proxy(b.destory,b)()}}return e})